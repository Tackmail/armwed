<!doctype html>
<html lang="th">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>Sign</title>
	<link rel="stylesheet" href="styles.css" />
	<style>
	:root{
		--bg:#fffbea;           /* pale yellow background */
		--accent:#d9a700;       /* primary yellow accent */
		--accent-dark:#b67b00;  /* darker accent for shadows */
		--card:#ffffff;         /* card background */
		--muted:#8a7320;        /* muted text for secondary */
		--input-border: rgba(182,123,0,0.12);
		--text:#3b2b00;
	}

	html,body{
		height:100%;
		margin:0;
		padding:0;
		font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
		background: linear-gradient(180deg, #fffdf3 0%, var(--bg) 40%, #fff 100%);
		color:var(--text);
		-webkit-font-smoothing:antialiased;
		-moz-osx-font-smoothing:grayscale;
	}

	.container {
		max-width:680px;
		margin:36px auto;
		padding:26px;
		background: linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,250,0.95));
		border-radius:16px;
		box-shadow: 0 10px 40px rgba(182,123,0,0.08);
		border: 1px solid rgba(182,123,0,0.06);
	}

	h1, h2 {
		text-align:center;
		color: var(--accent);
		margin:6px 0 16px;
		letter-spacing:0.6px;
	}

	.form-row { margin:14px 0; }
	.form-row label { display:block; margin-bottom:6px; color:var(--muted); font-weight:600; font-size:14px; }
	.form-row input, .form-row textarea, .form-row select {
		width:100%;
		padding:12px 14px;
		border-radius:12px;
		border:1px solid var(--input-border);
		background: linear-gradient(180deg,#fff,#fffaf0);
		box-shadow: inset 0 1px 0 rgba(0,0,0,0.02);
		color:var(--text);
		font-size:15px;
		outline:none;
		transition: box-shadow .12s ease, transform .06s ease, border-color .12s ease;
	}
	.form-row input:focus, .form-row textarea:focus, .form-row select:focus {
		box-shadow: 0 6px 18px rgba(213,150,0,0.08);
		border-color: rgba(213,150,0,0.22);
		transform: translateY(-1px);
	}

	.btn { 
		border-radius:10px;
		font-weight:700;
		padding:10px 16px;
		background: linear-gradient(90deg,var(--accent), #f7c948);
		color:#fff;
		border:none;
		box-shadow: 0 8px 24px rgba(182,123,0,0.14);
		cursor:pointer;
		transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
	}
	.btn:disabled { opacity:.6; cursor:not-allowed; transform:none; box-shadow:none; }
	.btn:hover:not(:disabled){ transform: translateY(-3px); box-shadow: 0 14px 36px rgba(182,123,0,0.18); }

	.muted {
		background: transparent;
		color: var(--muted);
		border:1px solid rgba(182,123,0,0.10);
		padding:8px 12px;
		border-radius:10px;
	}

	.reg-list { list-style:none; padding:0; margin:0; display:block; }
	.reg-list li {
		position:relative;
		background: linear-gradient(90deg,#fff,#fffaf0);
		padding:12px 14px;
		border-radius:12px;
		margin-bottom:10px;
		box-shadow: 0 6px 18px rgba(182,123,0,0.06);
		border:1px solid rgba(182,123,0,0.04);
	}
	.reg-list li button {
		position:absolute; top:10px; right:10px;
		background:transparent; border:1px solid rgba(0,0,0,0.06);
		padding:6px 8px; border-radius:8px; color:var(--muted);
	}
	.form-row--inline { display:flex; align-items:center; gap:12px; }
	.qty-input { width:110px; margin-left:8px; padding:10px 12px; border-radius:10px; }

	.input-error { color:#b00020; font-size:13px; margin-top:6px; display:block; }

	/* responsive tweaks */
	@media (max-width:520px){
		.container{ margin:16px; padding:18px; }
		.btn{ width:100%; }
		.form-row--inline{ flex-direction:column; align-items:flex-start; }
		.qty-input{ margin-left:0; width:100%; }
	}

	/* modal / review styles */
	.modal-backdrop {
		position:fixed; inset:0; background:rgba(0,0,0,0.32); backdrop-filter: blur(2px);
	}
	.modal {
		position:fixed; inset:0; display:flex; align-items:center; justify-content:center; z-index:60;
	}
	.modal-content {
		width: 92%; max-width:520px; background:var(--card); border-radius:12px; padding:18px;
		box-shadow: 0 18px 50px rgba(0,0,0,0.18); border:1px solid rgba(0,0,0,0.04);
		transform: translateY(8px); transition: transform .12s ease, opacity .12s ease;
	}
	.modal h3 { margin:0 0 8px; color:var(--accent); }
	.review-row { font-size:14px; color:var(--text); margin:8px 0; }
	.modal-actions { display:flex; gap:8px; justify-content:flex-end; margin-top:12px; }

	/* Logo and rewards section */
	.rewards-header {
		display: flex;
		align-items: center;
		gap: 20px;
		margin-bottom: 30px;
		padding: 20px;
		background: linear-gradient(135deg, #fff8e1, #fffdf5);
		border-radius: 16px;
		box-shadow: 0 4px 20px rgba(182,123,0,0.08);
	}

	.logo-section {
		display: flex;
		align-items: center;
		gap: 15px;
	}

	.golden-ticket {
		width: 80px;
		height: 80px;
		background: linear-gradient(45deg, #ffd700, #ffeb3b);
		border-radius: 12px;
		display: flex;
		align-items: center;
		justify-content: center;
		box-shadow: 0 4px 15px rgba(255,215,0,0.3);
		position: relative;
		overflow: hidden;
	}

	.golden-ticket::after {
		content: "üé´";
		font-size: 40px;
	}

	.voucher-text {
		display: flex;
		flex-direction: column;
	}

	.voucher-text h2 {
		margin: 0;
		color: var(--accent);
		font-size: 24px;
		text-align: left;
	}

	.voucher-text p {
		margin: 5px 0 0;
		color: var(--muted);
		font-size: 14px;
	}

	.mini-prizes {
		display: flex;
		gap: 10px;
		margin-left: auto;
	}

	.mini-prize {
		width: 50px;
		height: 50px;
		background: white;
		border-radius: 8px;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 24px;
		box-shadow: 0 2px 8px rgba(0,0,0,0.06);
		border: 1px solid rgba(182,123,0,0.1);
	}

	@media (max-width: 600px) {
		.rewards-header {
			flex-direction: column;
			text-align: center;
		}
		.mini-prizes {
			margin: 15px auto 0;
		}
		.voucher-text h2 {
			text-align: center;
		}
	}
	</style>
</head>
<body>
	<div class="container">
		<!-- Replace slider with new rewards header -->
		<div class="rewards-header">
			<div class="logo-section">
				<div class="golden-ticket"></div>
				<div class="voucher-text">
					<h2>Voucher Gift</h2>
					<p>‡∏•‡∏∏‡πâ‡∏ô‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏°‡∏≤‡∏Å‡∏°‡∏≤‡∏¢</p>
				</div>
			</div>
			<div class="mini-prizes">
				<div class="mini-prize">üéÅ</div>
				<div class="mini-prize">üèÜ</div>
				<div class="mini-prize">üíù</div>
			</div>
		</div>

		<h1>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>

		<!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô -->
		<form id="regForm" onsubmit="return false;">
			<div class="form-row">
				<label for="nameInput">Name</label>
				<input id="nameInput" type="text" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠" />
			</div>
			<div class="form-row">
				<label for="phoneInput">Contact</label>
				<input id="phoneInput" type="tel" placeholder="xxx-xxx-xxx" />
				<small id="phoneError" class="input-error" style="display:none"></small>
			</div>
			<div class="form-row">
				<label for="addressInput">Address</label>
				<textarea id="addressInput" rows="2" placeholder="‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤"></textarea>
			</div>
			<div class="form-row">
				<label for="itemSelect">Choice</label>
				<select id="itemSelect"></select>
			</div>
			<!-- item manager: add / edit / delete -->
			<div class="form-row">
				<label>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
				<div style="display:flex;gap:8px;">
					<input id="newItemInput" type="text" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà (‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∏‡∏î‡∏Å‡∏¥‡∏ô‡πÄ‡∏≠‡∏≤‡∏≠‡∏¢‡∏π‡πà)" />
					<button id="addItemBtn" type="button" class="btn">ADD</button>
				</div>
				<ul id="itemList" style="list-style:none;margin:10px 0 0;padding:0;"></ul>
			</div>
			<div class="form-row form-row--inline">
				<label for="qtyInput">piece</label>
				<input id="qtyInput" class="qty-input" type="number" min="1" value="1" />
			</div>

			<div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end;">
				<button id="clearBtn" type="button" class="muted">CLEAR</button>
				<button id="goPickBtn" type="button" class="muted">LUCKY SPIN</button>
				<button id="registerBtn" type="button" class="btn">APPLY</button>
			</div>
		</form>

		<!-- review modal (hidden by default) -->
		<div id="reviewModal" class="modal" style="display:none;">
			<div class="modal-backdrop"></div>
			<div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="reviewTitle">
				<h3 id="reviewTitle">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h3>
				<div id="reviewBody">
					<!-- populated by JS -->
				</div>
				<div class="modal-actions">
					<button id="confirmSave" class="btn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
					<button id="cancelReview" class="muted">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
				</div>
			</div>
		</div>

		<hr style="margin:18px 0;" />

		<h2>REGISTER</h2>
		<div id="registrations">There are no registered users yet</div>
	</div>

	<script>
	// ‡πÉ‡∏ä‡πâ API ‡πÄ‡∏î‡∏¥‡∏° (/api/votes) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
	async function fetchVotes() {
		try {
			const res = await fetch('/api/votes');
			return await res.json();
		} catch (e) {
			return { options: [] };
		}
	}

	// localStorage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô
	function loadRegistrations() {
		try { return JSON.parse(localStorage.getItem('registrations') || '[]'); } catch (e) { return []; }
	}
	function saveRegistrations(arr) {
		localStorage.setItem('registrations', JSON.stringify(arr));
	}

	function renderRegistrations() {
		const list = loadRegistrations();
		const container = document.getElementById('registrations');
		container.innerHTML = '';
		if (!list.length) {
			container.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô';
			return;
		}
		const ul = document.createElement('ul');
		ul.className = 'reg-list';
		list.forEach((r, idx) => {
			const li = document.createElement('li');
			li.innerHTML = `<strong>${r.name}</strong> ‚Äî ${r.phone || '-'}<br/><small>${r.item} x${r.qty} ‚Ä¢ ${r.address || '-'}</small>`;
			const del = document.createElement('button');
			del.type = 'button';
			del.className = 'muted small';
			del.textContent = '‡∏•‡∏ö';
			del.onclick = () => {
				const arr = loadRegistrations();
				arr.splice(idx,1);
				saveRegistrations(arr);
				renderRegistrations();
			};
			li.appendChild(del);
			ul.appendChild(li);
		});
		container.appendChild(ul);
	}

	// --- phone validation: only digits, length must be 9 or 10 ---
	function normalizePhone(v) {
		return (v || '').replace(/\D/g,'')
	}
	function isPhoneValid(v) {
		const n = normalizePhone(v);
		return n.length >= 9 && n.length <= 10;
	}
	function setPhoneError(msg) {
		const el = document.getElementById('phoneError');
		if (!el) return;
		if (msg) { el.textContent = msg; el.style.display = 'block'; }
		else { el.textContent = ''; el.style.display = 'none'; }
	}
	function updateRegisterEnabled() {
		const name = document.getElementById('nameInput').value.trim();
		const phone = document.getElementById('phoneInput').value;
		const address = document.getElementById('addressInput').value.trim();
		const qty = Math.max(1, parseInt(document.getElementById('qtyInput').value || '0', 10));
		const btn = document.getElementById('registerBtn');
		// require name, valid phone, address non-empty, and qty >= 1
		const valid = name.length > 0 && isPhoneValid(phone) && address.length > 0 && qty >= 1;
		btn.disabled = !valid;
		// show inline error when phone present but invalid
		if (phone.trim().length > 0 && !isPhoneValid(phone)) {
			setPhoneError('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 9 ‡∏ñ‡∏∂‡∏á 10 ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
		} else {
			setPhoneError('');
		}
	}

	// attach live validation listeners so APPLY enables/disables as user types/changes fields
	(function attachLiveListeners(){
		const fields = [
			'document.getElementById("nameInput")',
			'document.getElementById("phoneInput")',
			'document.getElementById("addressInput")',
			'document.getElementById("qtyInput")',
			'document.getElementById("itemSelect")'
		].map(expr => { try { return eval(expr); } catch(e){ return null; } });

		fields.forEach(el => {
			if (!el) return;
			const ev = (el.tagName === 'SELECT' || el.type === 'number') ? 'change' : 'input';
			el.addEventListener(ev, updateRegisterEnabled, { passive: true });
		});
	})();

	// --- items management (stored in localStorage) ---
	function loadItems() {
		try { return JSON.parse(localStorage.getItem('items') || '[]'); } catch(e){ return []; }
	}
	function saveItems(arr) {
		localStorage.setItem('items', JSON.stringify(arr));
	}
	function shuffleArray(a){
		for(let i=a.length-1;i>0;i--){
			const j = Math.floor(Math.random()*(i+1));
			[a[i],a[j]] = [a[j],a[i]];
		}
		return a;
	}
	// populate select with a randomized order
	function populateSelect(){
		const select = document.getElementById('itemSelect');
		let items = loadItems() || [];
		// fallback to defaults if empty (but do not overwrite if API will fill later in init)
		if (!items.length) items = ['‡∏ä‡∏∏‡∏î‡∏Å‡∏¥‡∏ô‡πÄ‡∏≠‡∏≤‡∏≠‡∏¢‡∏π‡πà','‡∏ä‡∏∏‡∏î‡∏Å‡∏¥‡∏ô‡πÄ‡∏≠‡∏≤‡πÄ‡∏õ‡πá‡∏ô','‡∏ä‡∏∏‡∏î‡∏Å‡∏¥‡∏ô‡πÄ‡∏≠‡∏≤‡∏ï‡∏≤‡∏¢'];
		const shuffled = shuffleArray(items.slice());
		select.innerHTML = '';
		shuffled.forEach(it => {
			const opt = document.createElement('option');
			opt.value = it;
			opt.textContent = it;
			select.appendChild(opt);
		});
	}
	// render small list for editing/deleting items
	function renderItemList(){
		const ul = document.getElementById('itemList');
		ul.innerHTML = '';
		const items = loadItems();
		if (!items.length) { ul.innerHTML = '<li style="color:var(--muted)">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</li>'; return; }
		items.forEach((it,i) => {
			const li = document.createElement('li');
			li.style.display = 'flex';
			li.style.alignItems = 'center';
			li.style.justifyContent = 'space-between';
			li.style.padding = '6px 8px';
			li.style.borderRadius = '8px';
			li.style.marginBottom = '6px';
			li.style.background = 'linear-gradient(90deg,#fff,#fffaf0)';
			li.innerHTML = `<span>${it}</span>
				<span style="display:flex;gap:6px">
					<button class="muted" data-edit="${i}" type="button">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
					<button class="muted" data-del="${i}" type="button">‡∏•‡∏ö</button>
				</span>`;
			ul.appendChild(li);
		});
		// attach handlers
		ul.querySelectorAll('[data-del]').forEach(btn => {
			btn.addEventListener('click', () => {
				const idx = Number(btn.getAttribute('data-del'));
				const arr = loadItems();
				if (!confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ "'+arr[idx]+'"?')) return;
				arr.splice(idx,1);
				saveItems(arr);
				renderItemList();
				populateSelect();
			});
		});
		ul.querySelectorAll('[data-edit]').forEach(btn => {
			btn.addEventListener('click', () => {
				const idx = Number(btn.getAttribute('data-edit'));
				const arr = loadItems();
				const current = arr[idx];
				const val = prompt('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', current);
				if (val === null) return;
				const v = String(val).trim();
				if (!v) { alert('‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ'); return; }
				arr[idx] = v;
				saveItems(arr);
				renderItemList();
				populateSelect();
			});
		});
	}
	// add new item
	document.getElementById('addItemBtn').addEventListener('click', () => {
		const inp = document.getElementById('newItemInput');
		const v = (inp.value || '').trim();
		if (!v) return;
		const arr = loadItems();
		arr.push(v);
		saveItems(arr);
		inp.value = '';
		renderItemList();
		populateSelect();
	});

	// gather current form data & count filled fields
	function gatherFormData() {
		const name = document.getElementById('nameInput').value.trim();
		const phone = document.getElementById('phoneInput').value.trim();
		const address = document.getElementById('addressInput').value.trim();
		const itemSelect = document.getElementById('itemSelect');
		const itemLabel = itemSelect.options[itemSelect.selectedIndex]?.text || itemSelect.value;
		const qty = Math.max(1, parseInt(document.getElementById('qtyInput').value || '1', 10));
		const fields = [name, phone, address, itemLabel, String(qty)];
		const filledCount = fields.filter(f => f && f !== '0').length;
		return { name, phone, address, itemLabel, qty, filledCount, totalFields: fields.length };
	}

	// open review modal and populate summary
	function openReviewModal() {
		const data = gatherFormData();
		const body = document.getElementById('reviewBody');
		body.innerHTML = `
			<div class="review-row"><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${data.name || '-'}</div>
			<div class="review-row"><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå:</strong> ${data.phone || '-'}</div>
			<div class="review-row"><strong>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</strong> ${data.address || '-'}</div>
			<div class="review-row"><strong>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</strong> ${data.itemLabel || '-'}</div>
			<div class="review-row"><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</strong> ${data.qty}</div>
			<div class="review-row" style="margin-top:10px;color:var(--muted);">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö: ${data.filledCount}/${data.totalFields}</div>
		`;
		document.getElementById('reviewModal').style.display = 'flex';
	}

	// close modal
	function closeReviewModal() {
		document.getElementById('reviewModal').style.display = 'none';
	}

	// perform validation and save (used by APPLY and modal confirm)
	function performSave() {
		const data = gatherFormData();
		if (!data.name) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠'); return; }
		if (!isPhoneValid(data.phone)) { setPhoneError('‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 9 ‡∏´‡∏£‡∏∑‡∏≠ 10 ‡∏´‡∏•‡∏±‡∏Å'); return; }
		if (!data.address) { alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà'); return; }

		const arr = loadRegistrations();
		arr.unshift({ name: data.name, phone: data.phone, address: data.address, item: data.itemLabel, qty: data.qty, ts: Date.now() });
		saveRegistrations(arr);

		try { localStorage.removeItem('voter_name'); } catch(e){}
		document.getElementById('nameInput').value = '';
		document.getElementById('phoneInput').value = '';
		document.getElementById('addressInput').value = '';
		document.getElementById('qtyInput').value = '1';
		setPhoneError('');
		closeReviewModal();
		renderRegistrations();
		updateRegisterEnabled();
	}
	// APPLY: validate and save directly
	document.getElementById('registerBtn').addEventListener('click', () => {
		updateRegisterEnabled();
		const btn = document.getElementById('registerBtn');
		if (btn.disabled) return;
		performSave();
	});
 
	// modal confirm uses same save routine
	document.getElementById('confirmSave').addEventListener('click', performSave);
 
 	document.getElementById('cancelReview').addEventListener('click', () => {
 		closeReviewModal();
 	});

	// ensure clear hides modal if open and clears fields
	document.getElementById('clearBtn').addEventListener('click', () => {
		document.getElementById('nameInput').value = '';
		document.getElementById('phoneInput').value = '';
		document.getElementById('addressInput').value = '';
		document.getElementById('qtyInput').value = '1';
		try { localStorage.removeItem('voter_name'); } catch(e){}
		closeReviewModal();
		updateRegisterEnabled();
	});

	// go to pick page
	document.getElementById('goPickBtn').addEventListener('click', () => {
		location.href = './pick.html';
	});
	// populate item select and setup handlers
	(async function init() {
		// try to load saved items; if empty try API then defaults
		let items = loadItems();
		if (!items.length) {
			try {
				const data = await fetchVotes();
				if (data.options && data.options.length) items = data.options.map(o => o.label || o.id);
			} catch(e){}
		}
		if (!items.length) items = ['‡∏ä‡∏∏‡∏î‡∏Å‡∏¥‡∏ô‡πÄ‡∏≠‡∏≤‡∏≠‡∏¢‡∏π‡πà','‡∏ä‡∏∏‡∏î‡∏Å‡∏¥‡∏ô‡πÄ‡∏≠‡∏≤‡πÄ‡∏õ‡πá‡∏ô','‡∏ä‡∏∏‡∏î‡∏Å‡∏¥‡∏ô‡πÄ‡∏≠‡∏≤‡∏ï‡∏≤‡∏¢'];
		// ensure persisted
		saveItems(items);
		// render manager UI and populate select with shuffled order
		renderItemList();
		populateSelect();

		// preload ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å localStorage (voter_name ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
		const nameEl = document.getElementById('nameInput');
		try {
			const saved = localStorage.getItem('voter_name') || '';
			if (saved) nameEl.value = saved;
		} catch(e){}

		renderRegistrations();
		updateRegisterEnabled();
	})();
	</script>
</body>
</html>
